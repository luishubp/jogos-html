<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>FNAF: Direto ao Ponto</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'VT323', monospace; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-container { position: relative; width: 100vw; height: 56.25vw; max-width: 1280px; max-height: 720px; background: #000; overflow: hidden; border: 4px solid #333; }

        /* OFFICE */
        #office-screen { position: relative; width: 100%; height: 100%; background: #080808; }
        .door { position: absolute; top: -100%; width: 15%; height: 100%; background: #151515; border: 4px solid #000; transition: top 0.2s; z-index: 50; }
        .door-closed { top: 0% !important; }
        
        .light { position: absolute; width: 35%; height: 100%; opacity: 0; pointer-events: none; z-index: 40; background: rgba(255,255,230,0.3); filter: blur(40px); }

        /* MONITOR & MAPA */
        #monitor { position: absolute; inset: 0; background: #000; display: none; z-index: 500; border: 10px solid #222; }
        #map-area { position: absolute; bottom: 20px; right: 20px; width: 250px; height: 260px; background: rgba(0,0,0,0.85); border: 2px solid #555; padding: 10px; z-index: 600; }
        
        .map-grid { display: grid; grid-template-areas: 
            ". c1A ." "c5 c1B c7" "c1C . c6" "c3 c2A c4A" "c2B you c4B"; 
            gap: 5px; height: 100%; 
        }
        .cam-btn { background: #1a1a1a; border: 1px solid #666; color: #fff; cursor: pointer; font-size: 11px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .cam-btn.active { background: #fff; color: #000; }
        .you-label { grid-area: you; color: #0f0; border: 1px dashed #0f0; display: flex; align-items: center; justify-content: center; font-size: 12px; }

        .dot { position: absolute; width: 20px; height: 20px; border-radius: 50%; display: none; z-index: 100; border: 1px solid #fff; }
        
        /* BOTÕES DE CONTROLE */
        .ctrl-btn { padding: 10px; font-family: 'VT323'; cursor: pointer; background: #222; color: #fff; border: 1px solid #444; width: 60px; }
        .ctrl-btn:active { background: #444; }

        #monitor-lever { position: absolute; bottom: 0; left: 25%; width: 50%; height: 35px; background: rgba(255,255,255,0.1); z-index: 1000; cursor: pointer; text-align: center; line-height: 35px; font-size: 12px; color: #444; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="office-screen">
        <div id="dr-L" class="door" style="left:5%;"></div>
        <div id="dr-R" class="door" style="right:5%;"></div>
        <div id="li-L" class="light" style="left:0;"></div>
        <div id="li-R" class="light" style="right:0;"></div>

        <div style="position:absolute; top:40%; left:1%; z-index:100; display:flex; flex-direction:column; gap:10px;">
            <button class="ctrl-btn" onclick="game.toggleDoor('left')">DOOR</button>
            <button class="ctrl-btn" onclick="game.toggleLight('left')">LIGHT</button>
        </div>
        <div style="position:absolute; top:40%; right:1%; z-index:100; display:flex; flex-direction:column; gap:10px;">
            <button class="ctrl-btn" onclick="game.toggleDoor('right')">DOOR</button>
            <button class="ctrl-btn" onclick="game.toggleLight('right')">LIGHT</button>
        </div>

        <div id="monitor">
            <div id="v-Bonnie" class="dot" style="background:#90f;"></div>
            <div id="v-Chica" class="dot" style="background:#ff0;"></div>
            <div id="v-Freddy" class="dot" style="background:#63422e;"></div>
            <div id="v-Foxy" class="dot" style="background:#a00;"></div>
            
            <h2 id="cam-tag" style="position:absolute; top:20px; left:20px;">CAM 1A - STAGE</h2>

            <div id="map-area">
                <div class="map-grid">
                    <div class="cam-btn" style="grid-area:c1A" onclick="game.setCam('1A','STAGE')">1A<br>Stage</div>
                    <div class="cam-btn" style="grid-area:c1B" onclick="game.setCam('1B','DINING')">1B<br>Dining</div>
                    <div class="cam-btn" style="grid-area:c1C" onclick="game.setCam('1C','COVE')">1C<br>Foxy</div>
                    <div class="cam-btn" style="grid-area:c5" onclick="game.setCam('5','BACK')">5<br>Parts</div>
                    <div class="cam-btn" style="grid-area:c7" onclick="game.setCam('7','REST')">7<br>Toilet</div>
                    <div class="cam-btn" style="grid-area:c3" onclick="game.setCam('3','CLOSET')">3<br>Supply</div>
                    <div class="cam-btn" style="grid-area:c6" onclick="game.setCam('6','KITCHEN')">6<br>Kitchen</div>
                    <div class="cam-btn" style="grid-area:c2A" onclick="game.setCam('2A','HALL L')">2A<br>Hall L</div>
                    <div class="cam-btn" style="grid-area:c2B" onclick="game.setCam('2B','CORNER L')">2B<br>Corner</div>
                    <div class="cam-btn" style="grid-area:c4A" onclick="game.setCam('4A','HALL R')">4A<br>Hall R</div>
                    <div class="cam-btn" style="grid-area:c4B" onclick="game.setCam('4B','CORNER R')">4B<br>Corner</div>
                    <div class="you-label">VOCÊ</div>
                </div>
            </div>
        </div>

        <div style="position:absolute; bottom:10px; left:10px; color:#0f0; font-size:24px;">POWER: <span id="p-val">100</span>%</div>
        <div id="monitor-lever" onclick="game.toggleMon()">MONITOR</div>
    </div>
</div>

<script>
class FNAFEngine {
    constructor() {
        this.pwr = 100; this.mon = false; this.cam = '1A';
        this.doors = {left: false, right: false};
        this.lights = {left: false, right: false};
        
        // Definição de caminhos lineares
        this.ai = {
            'Bonnie': { pos: '1A', path: ['1A', '1B', '5', '3', '2A', '2B', 'AT_DOOR'] },
            'Chica':  { pos: '1A', path: ['1A', '1B', '7', '6', '4A', '4B', 'AT_DOOR'] },
            'Freddy': { pos: '1A', path: ['1A', '1B', '7', '4A', '4B', 'AT_DOOR'] },
            'Foxy':   { pos: '1C', stage: 0 } // Foxy tem mecânica de estágio
        };
        
        this.start();
    }

    start() {
        setInterval(() => {
            this.pwr -= (0.1 + (this.doors.left?0.3:0) + (this.doors.right?0.3:0) + (this.mon?0.15:0));
            document.getElementById('p-val').innerText = Math.max(0, Math.floor(this.pwr));
            if(this.pwr <= 0) location.reload();
        }, 1000);

        setInterval(() => this.moveAI(), 5000); // Tenta mover a cada 5 segundos
    }

    toggleDoor(s) {
        this.doors[s] = !this.doors[s];
        document.getElementById(`dr-${s==='left'?'L':'R'}`).classList.toggle('door-closed', this.doors[s]);
    }

    toggleLight(s) {
        this.lights[s] = !this.lights[s];
        // Desliga a outra luz ao clicar
        const other = s === 'left' ? 'right' : 'left';
        this.lights[other] = false;
        
        document.getElementById('li-L').style.opacity = this.lights.left ? 1 : 0;
        document.getElementById('li-R').style.opacity = this.lights.right ? 1 : 0;
    }

    toggleMon() {
        this.mon = !this.mon;
        document.getElementById('monitor').style.display = this.mon ? 'block' : 'none';
        if(this.mon) this.updateVisuals();
    }

    setCam(id, name) {
        this.cam = id;
        document.getElementById('cam-tag').innerText = `CAM ${id} - ${name}`;
        document.querySelectorAll('.cam-btn').forEach(b => b.classList.remove('active'));
        Array.from(document.querySelectorAll('.cam-btn')).forEach(b => {
            if(b.innerText.includes(id)) b.classList.add('active');
        });
        this.updateVisuals();
    }

    updateVisuals() {
        ['Bonnie', 'Chica', 'Freddy', 'Foxy'].forEach(name => {
            const char = this.ai[name];
            const dot = document.getElementById('v-' + name);
            if(char.pos === this.cam) {
                dot.style.display = 'block';
                dot.style.left = (30 + Math.random() * 30) + "%";
                dot.style.top = (30 + Math.random() * 30) + "%";
            } else {
                dot.style.display = 'none';
            }
        });
    }

    moveAI() {
        for(let name in this.ai) {
            let char = this.ai[name];
            
            // Foxy (Pirate Cove)
            if(name === 'Foxy') {
                if(Math.random() > 0.7) {
                    char.stage++;
                    if(char.stage > 3) {
                        if(!this.doors.left) { alert("Foxy pegou você!"); location.reload(); }
                        else { char.stage = 0; }
                    }
                }
                continue;
            }

            // Bonnie, Chica e Freddy (Caminho Linear)
            if(Math.random() > 0.6) {
                let currentIdx = char.path.indexOf(char.pos);
                if(currentIdx < char.path.length - 1) {
                    char.pos = char.path[currentIdx + 1];
                    console.log(name + " moveu para " + char.pos);
                } else {
                    // Está na porta
                    const door = name === 'Bonnie' ? 'left' : 'right';
                    if(!this.doors[door]) {
                        alert(name + " entrou na sala!");
                        location.reload();
                    } else {
                        char.pos = '1A'; // Volta pro palco se a porta estiver fechada
                    }
                }
            }
        }
        if(this.mon) this.updateVisuals();
    }
}

const game = new FNAFEngine();
</script>
</body>
    </html>
