<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>FNAF: Ultimate Fix</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'VT323', monospace; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-container { position: relative; width: 100vw; height: 56.25vw; max-width: 1280px; max-height: 720px; background: #000; overflow: hidden; border: 4px solid #222; }

        /* SISTEMA DE MENUS */
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; background: #000; }
        #main-menu { display: flex; }
        .active-screen { display: flex !important; }

        .ai-config { display: flex; gap: 10px; margin: 20px 0; }
        .ai-card { background: #111; padding: 10px; border: 2px solid #333; text-align: center; width: 85px; }
        .ai-card input { width: 45px; background: #000; color: #fff; border: 1px solid #555; font-family: 'VT323'; font-size: 20px; text-align: center; }
        
        button { padding: 10px 25px; font-family: 'VT323'; font-size: 22px; cursor: pointer; background: #222; color: #fff; border: 2px solid #444; }
        button:hover { background: #fff; color: #000; }

        /* OFFICE & MAP */
        #office-screen { position: relative; width: 100%; height: 100%; background: #080808; }
        .door { position: absolute; top: -100%; width: 15%; height: 100%; background: #151515; border: 4px solid #000; transition: top 0.1s; z-index: 50; }
        .door-closed { top: 0% !important; }
        
        .light { position: absolute; width: 35%; height: 100%; opacity: 0; pointer-events: none; z-index: 40; background: rgba(255,255,230,0.35); filter: blur(40px); }

        /* MONITOR & MAPA */
        #monitor { position: absolute; inset: 0; background: #000; display: none; z-index: 500; border: 10px solid #222; }
        #map-area { position: absolute; bottom: 20px; right: 20px; width: 250px; height: 260px; background: rgba(0,0,0,0.8); border: 2px solid #555; padding: 10px; z-index: 600; }
        
        .map-grid { display: grid; grid-template-areas: 
            ". c1A ." "c5 c1B c7" "c1C . c6" "c3 c2A c4A" "c2B you c4B"; 
            gap: 5px; height: 100%; 
        }
        .cam-btn { background: #1a1a1a; border: 1px solid #666; color: #fff; cursor: pointer; font-size: 11px; display: flex; flex-direction: column; align-items: center; justify-content: center; line-height: 1; }
        .cam-btn span { font-size: 9px; color: #888; margin-top: 2px; }
        .cam-btn.active { background: #fff; color: #000; }
        .you-label { grid-area: you; color: #0f0; border: 1px dashed #0f0; display: flex; align-items: center; justify-content: center; font-size: 12px; }

        .dot { position: absolute; width: 25px; height: 25px; border-radius: 50%; display: none; z-index: 100; border: 2px solid #fff; }
        #monitor-up { position: absolute; bottom: 0; left: 25%; width: 50%; height: 40px; background: rgba(255,255,255,0.1); z-index: 1000; cursor: pointer; border: 1px solid #333; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="main-menu" class="screen">
        <h1 style="font-size: 60px;">FIVE NIGHTS</h1>
        <button onclick="showScreen('custom-screen')">CUSTOM NIGHT</button>
    </div>

    <div id="custom-screen" class="screen">
        <h2>DEFINIR DIFICULDADE (0-20)</h2>
        <div class="ai-config">
            <div class="ai-card" style="color:#90f;">Bonnie<br><input type="number" id="lv-b" value="0" max="20"></div>
            <div class="ai-card" style="color:#ff0;">Chica<br><input type="number" id="lv-c" value="0" max="20"></div>
            <div class="ai-card" style="color:#63422e;">Freddy<br><input type="number" id="lv-f" value="0" max="20"></div>
            <div class="ai-card" style="color:#a00;">Foxy<br><input type="number" id="lv-x" value="0" max="20"></div>
        </div>
        <button onclick="startGame()">START NIGHT</button>
    </div>

    <div id="office-screen" style="display:none;">
        <div id="dr-L" class="door" style="left:5%;"></div>
        <div id="dr-R" class="door" style="right:5%;"></div>
        <div id="li-L" class="light" style="left:0;"></div>
        <div id="li-R" class="light" style="right:0;"></div>

        <div style="position:absolute; top:40%; left:1%; z-index:100; display:flex; flex-direction:column; gap:10px;">
            <button onclick="game.toggleDoor('left')">DOOR</button>
            <button onclick="game.toggleLight('left')">LIGHT</button>
        </div>
        <div style="position:absolute; top:40%; right:1%; z-index:100; display:flex; flex-direction:column; gap:10px;">
            <button onclick="game.toggleDoor('right')">DOOR</button>
            <button onclick="game.toggleLight('right')">LIGHT</button>
        </div>

        <div id="monitor">
            <div id="v-Bonnie" class="dot" style="background:#90f;"></div>
            <div id="v-Chica" class="dot" style="background:#ff0;"></div>
            <div id="v-Freddy" class="dot" style="background:#63422e;"></div>
            <div id="v-Foxy" class="dot" style="background:#a00;"></div>
            
            <h2 id="cam-tag" style="position:absolute; top:20px; left:20px;">CAM 1A - STAGE</h2>

            <div id="map-area">
                <div class="map-grid">
                    <div class="cam-btn" style="grid-area:c1A" onclick="game.setCam('1A','STAGE')">1A<span>Stage</span></div>
                    <div class="cam-btn" style="grid-area:c1B" onclick="game.setCam('1B','DINING')">1B<span>Dining</span></div>
                    <div class="cam-btn" style="grid-area:c1C" onclick="game.setCam('1C','COVE')">1C<span>Cove</span></div>
                    <div class="cam-btn" style="grid-area:c5" onclick="game.setCam('5','BACK')">5<span>Parts</span></div>
                    <div class="cam-btn" style="grid-area:c7" onclick="game.setCam('7','REST')">7<span>Toilet</span></div>
                    <div class="cam-btn" style="grid-area:c3" onclick="game.setCam('3','CLOSET')">3<span>Supply</span></div>
                    <div class="cam-btn" style="grid-area:c6" onclick="game.setCam('6','KITCHEN')">6<span>Kitchen</span></div>
                    <div class="cam-btn" style="grid-area:c2A" onclick="game.setCam('2A','HALL L')">2A<span>Hall L</span></div>
                    <div class="cam-btn" style="grid-area:c2B" onclick="game.setCam('2B','CORNER L')">2B<span>Corner L</span></div>
                    <div class="cam-btn" style="grid-area:c4A" onclick="game.setCam('4A','HALL R')">4A<span>Hall R</span></div>
                    <div class="cam-btn" style="grid-area:c4B" onclick="game.setCam('4B','CORNER R')">4B<span>Corner R</span></div>
                    <div class="you-label">YOU</div>
                </div>
            </div>
        </div>

        <div style="position:absolute; bottom:10px; left:10px; color:#0f0; font-size:24px;">PWR: <span id="p-val">100</span>%</div>
        <div id="monitor-up" onclick="game.toggleMon()"></div>
    </div>
</div>

<script>
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
    document.getElementById(id).classList.add('active-screen');
}

function startGame() {
    // TRAVA DO NÚMERO 20
    const fix = (id) => Math.min(20, Math.max(0, parseInt(document.getElementById(id).value) || 0));
    document.getElementById('custom-screen').style.display = 'none';
    document.getElementById('office-screen').style.display = 'block';
    game.init(fix('lv-b'), fix('lv-c'), fix('lv-f'), fix('lv-x'));
}

class Engine {
    constructor() {
        this.pwr = 100; this.mon = false; this.cam = '1A';
        this.doors = {left: false, right: false};
        this.lights = {left: false, right: false};
        this.ai = {
            'Bonnie': {pos: '1A', path: ['1A','1B','5','2A','2B','DoorL'], show: ['1A','1B','5','2A','2B']},
            'Chica': {pos: '1A', path: ['1A','1B','7','4A','4B','DoorR'], show: ['1A','2B','4B']},
            'Freddy': {pos: '1A', path: ['1A','1B','7','6','4A','4B','DoorR'], show: ['1A','1B','7','6','4A','4B']},
            'Foxy': {pos: '1C', stage: 0}
        };
    }

    init(b, c, f, x) {
        this.ai.Bonnie.lv = b; this.ai.Chica.lv = c; this.ai.Freddy.lv = f; this.ai.Foxy.lv = x;
        setInterval(() => {
            this.pwr -= (0.12 + (this.doors.left?0.4:0) + (this.doors.right?0.4:0) + (this.mon?0.2:0));
            document.getElementById('p-val').innerText = Math.floor(this.pwr);
            if(this.pwr <= 0) location.reload();
        }, 1000);
        // IA MAIS RÁPIDA (Check a cada 3 segundos em vez de 4.5)
        setInterval(() => this.moveAI(), 3000);
        this.setCam('1A', 'STAGE');
    }

    toggleDoor(s) {
        this.doors[s] = !this.doors[s];
        document.getElementById(`dr-${s==='left'?'L':'R'}`).classList.toggle('door-closed', this.doors[s]);
    }

    toggleLight(s) {
        this.lights.left = false; this.lights.right = false;
        this.lights[s] = true; // Simula clique: acende apenas enquanto quiser
        document.getElementById('li-L').style.opacity = this.lights.left ? 1 : 0;
        document.getElementById('li-R').style.opacity = this.lights.right ? 1 : 0;
        // Apaga após 1 segundo para não travar ligada
        setTimeout(() => {
            this.lights[s] = false;
            document.getElementById('li-L').style.opacity = 0;
            document.getElementById('li-R').style.opacity = 0;
        }, 1000);
    }

    toggleMon() {
        this.mon = !this.mon;
        document.getElementById('monitor').style.display = this.mon ? 'block' : 'none';
    }

    setCam(id, name) {
        this.cam = id;
        document.getElementById('cam-tag').innerText = `CAM ${id} - ${name}`;
        document.querySelectorAll('.cam-btn').forEach(b => b.classList.remove('active'));
        // Seleciona o botão correto pelo texto
        Array.from(document.querySelectorAll('.cam-btn')).forEach(b => {
            if(b.innerText.includes(id)) b.classList.add('active');
        });
        this.updateDots();
    }

    updateDots() {
        ['Bonnie', 'Chica', 'Freddy', 'Foxy'].forEach(name => {
            const char = this.ai[name];
            const dot = document.getElementById('v-' + name);
            if(char.pos === this.cam && (char.show ? char.show.includes(this.cam) : true)) {
                dot.style.display = 'block';
                dot.style.left = (Math.random() * 50 + 20) + "%";
                dot.style.top = (Math.random() * 50 + 20) + "%";
            } else dot.style.display = 'none';
        });
    }

    moveAI() {
        for(let name in this.ai) {
            let e = this.ai[name];
            // Regra do Freddy: Não move se estiver sendo olhado
            if(name === 'Freddy' && this.mon && this.cam === e.pos) continue;

            if(Math.random() * 20 < e.lv) {
                if(name === 'Foxy') {
                    e.stage++; if(e.stage > 4) { if(!this.doors.left) location.reload(); else e.stage = 0; }
                } else {
                    let idx = e.path.indexOf(e.pos);
                    if(idx < e.path.length - 1) e.pos = e.path[idx+1];
                    else {
                        const side = name === 'Bonnie' ? 'left' : 'right';
                        if(!this.doors[side]) location.reload();
                        else e.pos = '1A';
                    }
                }
            }
        }
        if(this.mon) this.updateDots();
    }
}
const game = new Engine();
</script>
</body>
            </html>
