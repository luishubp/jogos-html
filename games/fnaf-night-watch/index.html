<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>FNAF: Freddy Update</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --pwr-color: #00ff00; }
        body { margin: 0; background: #000; color: #fff; font-family: 'VT323', monospace; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-container { position: relative; width: 100vw; height: 56.25vw; max-width: 1280px; max-height: 720px; border: 5px solid #111; overflow: hidden; background: #000; }

        /* OFFICE */
        #office-scene { width: 100%; height: 100%; position: relative; background: #080808; }
        .physical-door { position: absolute; top: -100%; width: 15%; height: 100%; background: #1a1a1a; border: 4px solid #000; transition: top 0.1s; z-index: 50; }
        .door-left { left: 5%; } .door-right { right: 5%; }
        .door-closed { top: 0% !important; }
        .light-effect { position: absolute; width: 45%; height: 100%; opacity: 0; pointer-events: none; z-index: 40; }
        #light-L { left: 0; background: radial-gradient(circle at 15% 50%, rgba(255,255,240,0.4), transparent 75%); }
        #light-R { right: 0; background: radial-gradient(circle at 85% 50%, rgba(255,255,240,0.4), transparent 75%); }
        .threat-at-door { position: absolute; top: 35%; width: 100px; height: 100px; border-radius: 50%; z-index: 45; display: none; filter: blur(10px); }

        /* CONTROLS */
        .door-controls { position: absolute; top: 40%; width: 60px; height: 130px; z-index: 100; display: flex; flex-direction: column; gap: 10px; }
        .ctrl-left { left: 1%; } .ctrl-right { right: 1%; }
        .btn-game { width: 60px; height: 55px; border: 3px solid #444; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; background: #222; color: #fff; user-select: none; }

        /* MONITOR & MAP (Conforme a imagem enviada) */
        #monitor { position: absolute; inset: 0; background: #000; display: none; z-index: 500; border: 10px solid #222; }
        .static { position: absolute; inset: 0; background: url('https://media.giphy.com/media/oEI9uWUuejgRTpFDkA/giphy.gif'); opacity: 0.12; z-index: 10; pointer-events: none; }
        .threat-point { position: absolute; width: 40px; height: 40px; border-radius: 50%; z-index: 5; display: none; filter: blur(3px); }

        #map-container { position: absolute; bottom: 20px; right: 20px; width: 320px; height: 280px; background: rgba(0,0,0,0.8); border: 2px solid #555; padding: 10px; z-index: 20; display: grid; grid-template-areas: 
            ". m1A ." "m5 m1B m7" "m1C . m6" "m3 m2A m4A" ". m2B m4B"; gap: 5px; 
        }
        .cam-node { background: #111; border: 1px solid #444; color: #fff; cursor: pointer; font-size: 14px; font-family: 'VT323'; }
        .cam-node.active { background: #fff; color: #000; }

        #jumpscare { position: absolute; inset: 0; z-index: 10000; display: none; background: #000; justify-content: center; align-items: center; }
        .shake { animation: vShake 0.05s infinite; }
        @keyframes vShake { 0% { transform: translate(10px,10px); } 50% { transform: translate(-10px,-10px); } 100% { transform: translate(5px,-5px); } }
        
        #monitor-toggle { position: absolute; bottom: 0; left: 30%; width: 40%; height: 40px; background: rgba(255,255,255,0.1); border: 1px solid #444; z-index: 1000; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="office-scene">
        <div id="office">
            <div id="door-L" class="physical-door door-left"></div>
            <div id="door-R" class="physical-door door-right"></div>
            <div id="light-L" class="light-effect"></div>
            <div id="light-R" class="light-effect"></div>
            <div id="threat-L" class="threat-at-door" style="left: 10%; color: #90f;"></div>
            <div id="threat-R" class="threat-at-door" style="right: 10%; color: #ff0;"></div>

            <div class="door-controls ctrl-left">
                <div class="btn-game" onclick="game.actionDoor('left')">DOOR</div>
                <div class="btn-game" onclick="game.actionLight('left')">LIGHT</div>
            </div>
            <div class="door-controls ctrl-right">
                <div class="btn-game" onclick="game.actionDoor('right')">DOOR</div>
                <div class="btn-game" onclick="game.actionLight('right')">LIGHT</div>
            </div>

            <div id="monitor">
                <div class="static"></div>
                <div id="vulto-cam" class="threat-point"></div>
                <div id="cam-label" style="position:absolute; top:20px; left:20px; font-size:30px;">CAM 1A</div>
                <div id="map-container">
                    <button class="cam-node" style="grid-area: m1A" onclick="game.switchCam('1A')">1A</button>
                    <button class="cam-node" style="grid-area: m1B" onclick="game.switchCam('1B')">1B</button>
                    <button class="cam-node" style="grid-area: m1C" onclick="game.switchCam('1C')">1C</button>
                    <button class="cam-node" style="grid-area: m5" onclick="game.switchCam('5')">5</button>
                    <button class="cam-node" style="grid-area: m7" onclick="game.switchCam('7')">7</button>
                    <button class="cam-node" style="grid-area: m3" onclick="game.switchCam('3')">3</button>
                    <button class="cam-node" style="grid-area: m6" onclick="game.switchCam('6')">6</button>
                    <button class="cam-node" style="grid-area: m2A" onclick="game.switchCam('2A')">2A</button>
                    <button class="cam-node" style="grid-area: m2B" onclick="game.switchCam('2B')">2B</button>
                    <button class="cam-node" style="grid-area: m4A" onclick="game.switchCam('4A')">4A</button>
                    <button class="cam-node" style="grid-area: m4B" onclick="game.switchCam('4B')">4B</button>
                </div>
            </div>

            <div style="position:absolute; bottom:20px; left:20px; font-size:25px;">POWER: <span id="pwr">100</span>%</div>
            <div style="position:absolute; top:20px; right:20px; font-size:40px;" id="time">12 AM</div>
            <div id="monitor-toggle" onclick="game.toggleMonitor()"></div>
        </div>
    </div>
    <div id="jumpscare" class="shake"><h1 style="font-size:120px; color:white;">ðŸ‘¹</h1></div>
</div>

<script>
class FNAF {
    constructor() {
        this.pwr = 100; this.mon = false; this.cam = '1A';
        this.doors = {left: false, right: false};
        this.lights = {left: false, right: false};
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        this.ai = {
            'Bonnie': {pos: '1A', color: '#90f', path: ['1A','1B','2A','2B','DoorL'], allowed: ['1A','1B','2A','2B']},
            'Chica': {pos: '2B', color: '#ff0', path: ['2B','4B','DoorR'], allowed: ['2B','4B']},
            'Freddy': {pos: '1A', color: '#63422e', path: ['1A','1B','7','6','4A','4B','DoorR'], allowed: ['1A','1B','7','6','4A','4B']}
        };
        this.init();
    }

    init() {
        setInterval(() => {
            this.pwr -= (0.15 + (this.doors.left?0.4:0) + (this.doors.right?0.4:0) + (this.mon?0.3:0));
            document.getElementById('pwr').innerText = Math.floor(this.pwr);
            if(this.pwr <= 0) location.reload();
        }, 1000);
        setInterval(() => this.moveAI(), 4000);
    }

    laugh() {
        const o = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        o.type = 'square';
        o.frequency.setValueAtTime(80, this.ctx.currentTime);
        o.frequency.exponentialRampToValueAtTime(40, this.ctx.currentTime + 0.5);
        g.gain.setValueAtTime(0.1, this.ctx.currentTime);
        o.connect(g); g.connect(this.ctx.destination);
        o.start(); o.stop(this.ctx.currentTime + 0.5);
    }

    actionDoor(s) {
        this.doors[s] = !this.doors[s];
        document.getElementById(`door-${s==='left'?'L':'R'}`).classList.toggle('door-closed', this.doors[s]);
    }

    actionLight(s) {
        this.lights[s] = !this.lights[s];
        this.lights[s==='left'?'right':'left'] = false;
        document.getElementById('light-L').style.opacity = this.lights.left ? 1 : 0;
        document.getElementById('light-R').style.opacity = this.lights.right ? 1 : 0;
        this.updateVisuals();
    }

    updateVisuals() {
        // Apenas Bonnie e Chica aparecem na luz
        document.getElementById('threat-L').style.display = (this.lights.left && this.ai.Bonnie.pos === 'DoorL') ? 'block' : 'none';
        document.getElementById('threat-R').style.display = (this.lights.right && this.ai.Chica.pos === 'DoorR') ? 'block' : 'none';
        document.getElementById('threat-L').style.backgroundColor = this.ai.Bonnie.color;
        document.getElementById('threat-R').style.backgroundColor = this.ai.Chica.color;
    }

    toggleMonitor() {
        this.mon = !this.mon;
        document.getElementById('monitor').style.display = this.mon ? 'block' : 'none';
        if(this.mon) this.switchCam(this.cam);
    }

    switchCam(id) {
        this.cam = id;
        document.getElementById('cam-label').innerText = "CAM " + id;
        document.querySelectorAll('.cam-node').forEach(b => b.classList.remove('active'));
        const btn = Array.from(document.querySelectorAll('.cam-node')).find(b => b.innerText === id);
        if(btn) btn.classList.add('active');

        const v = document.getElementById('vulto-cam');
        v.style.display = 'none';

        for(let n in this.ai) {
            let e = this.ai[n];
            if(e.pos === id && e.allowed.includes(id)) {
                v.style.display = 'block';
                v.style.backgroundColor = e.color;
                v.style.boxShadow = `0 0 30px ${e.color}`;
                v.style.left = Math.random() * 60 + 20 + "%";
                v.style.top = Math.random() * 60 + 20 + "%";
            }
        }
    }

    moveAI() {
        for(let n in this.ai) {
            let e = this.ai[n];
            // Regra do Freddy: SÃ³ move se nÃ£o estiver sendo olhado ou se monitor estiver fechado
            if(n === 'Freddy' && (this.mon && this.cam === e.pos)) continue;

            if(Math.random() > 0.6) {
                let idx = e.path.indexOf(e.pos);
                if(idx < e.path.length - 1) {
                    e.pos = e.path[idx+1];
                    if(n === 'Freddy') this.laugh(); // Freddy ri ao se mover
                } else {
                    let side = (n === 'Bonnie') ? 'left' : 'right';
                    if(!this.doors[side]) {
                        document.getElementById('jumpscare').style.display = 'flex';
                        setTimeout(() => location.reload(), 2000);
                    } else { e.pos = '1A'; }
                }
            }
        }
        if(this.mon) this.switchCam(this.cam);
        this.updateVisuals();
    }
}
const game = new FNAF();
</script>
</body>
    </html>
