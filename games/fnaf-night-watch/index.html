<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>FNAF: Fixed Version</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* RESET E CORPO */
        body { margin: 0; background: #000; color: #fff; font-family: 'VT323', monospace; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        
        /* CONTAINER DO JOGO */
        #game-container { 
            position: relative; width: 100vw; height: 56.25vw; 
            max-width: 1280px; max-height: 720px; 
            background: #111; border: 4px solid #444; overflow: hidden; 
        }

        /* ESCRITÓRIO (FIXO AGORA PARA NÃO SUMIR AS PORTAS) */
        #office-screen { 
            position: absolute; inset: 0; background: #1a1a1a; 
            z-index: 10;
            box-shadow: inset 0 0 100px #000;
        }

        /* PORTAS */
        .door-panel {
            position: absolute; top: 0; width: 15%; height: 100%; 
            background: #222; border-right: 5px solid #000; border-left: 5px solid #000;
            z-index: 20;
        }
        .door-metal {
            position: absolute; top: -100%; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(45deg, #333, #333 10px, #222 10px, #222 20px);
            transition: top 0.2s ease-in;
            z-index: 25;
            border-bottom: 5px solid #555;
        }
        .door-closed { top: 0% !important; }

        /* LUZES */
        .light-effect {
            position: absolute; top: 0; width: 40%; height: 100%;
            background: linear-gradient(to right, rgba(255,255,200,0.3), transparent);
            pointer-events: none; opacity: 0; z-index: 30; mix-blend-mode: overlay;
        }

        /* BOTÕES DAS PORTAS (Mesa) */
        .ctrl-panel {
            position: absolute; top: 45%; z-index: 100;
            background: #111; padding: 10px; border: 2px solid #555;
            display: flex; flex-direction: column; gap: 10px;
        }
        .ctrl-btn {
            width: 50px; height: 50px; cursor: pointer; border: none;
            font-family: 'VT323'; font-size: 18px; color: white;
            border-radius: 50%; border: 2px solid #fff;
        }
        .btn-door { background: #d00; }
        .btn-light { background: #ww0; color: #000; background: #fff; }
        .ctrl-btn:active { transform: scale(0.95); opacity: 0.8; }

        /* MONITOR (TELA CHEIA) */
        #monitor { 
            position: absolute; inset: 0; background: #000; 
            display: none; z-index: 500; border: 15px solid #333; 
        }
        
        /* MAPA DAS CÂMERAS */
        #map-ui {
            position: absolute; bottom: 20px; right: 20px;
            width: 280px; height: 220px;
            background: rgba(0,0,0,0.9); border: 2px solid #fff;
            display: grid; 
            grid-template-areas: 
                ". c1A ."
                "c5 c1B c7"
                "c1C . c6"
                "c3 c2A c4A"
                "c2B . c4B";
            gap: 5px; padding: 10px;
        }
        
        .cam-btn { 
            background: #333; color: #fff; border: 1px solid #777; 
            cursor: pointer; font-size: 12px; display: grid; place-items: center; 
        }
        .cam-btn.active { background: #fff; color: #000; animation: blink 1s infinite; }

        /* UI GERAL */
        #power-ui { position: absolute; bottom: 20px; left: 20px; font-size: 24px; z-index: 200; color: white;}
        #log-ui { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); color: #aaa; font-size: 14px; z-index: 200; }
        
        #btn-monitor-toggle {
            position: absolute; bottom: 0; left: 30%; width: 40%; height: 40px;
            background: rgba(255,255,255,0.2); border-top: 2px solid white;
            z-index: 600; cursor: pointer; display: grid; place-items: center;
            font-size: 20px; transition: 0.2s;
        }
        #btn-monitor-toggle:hover { background: rgba(255,255,255,0.4); }

        /* JUMPSCARE */
        #jumpscare-screen {
            position: fixed; inset: 0; background: black; z-index: 9999;
            display: none; align-items: center; justify-content: center;
        }
        #jumpscare-img { width: 100%; height: 100%; object-fit: cover; }

        /* PONTOS DOS ANIMATRONICS */
        .animatronic-dot { width: 15px; height: 15px; border-radius: 50%; position: absolute; border: 2px solid white; display: none; }
        
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

<div id="game-container">
    
    <div id="office-screen">
        
        <div class="door-panel" style="left: 0;">
            <div id="door-L" class="door-metal"></div>
        </div>
        <div id="light-L" class="light-effect" style="left: 15%; background: linear-gradient(to right, rgba(255,255,255,0.4), transparent);"></div>
        
        <div class="ctrl-panel" style="left: 16%;">
            <button class="ctrl-btn btn-door" onclick="game.toggleDoor('left')">DR</button>
            <button class="ctrl-btn btn-light" onclick="game.toggleLight('left')">LT</button>
        </div>

        <div class="door-panel" style="right: 0;">
            <div id="door-R" class="door-metal"></div>
        </div>
        <div id="light-R" class="light-effect" style="right: 15%; background: linear-gradient(to left, rgba(255,255,255,0.4), transparent);"></div>

        <div class="ctrl-panel" style="right: 16%;">
            <button class="ctrl-btn btn-door" onclick="game.toggleDoor('right')">DR</button>
            <button class="ctrl-btn btn-light" onclick="game.toggleLight('right')">LT</button>
        </div>

    </div>

    <div id="power-ui">POWER: <span id="pwr-val">100</span>%</div>
    <div id="log-ui">Noite 1 - 12 AM</div>

    <div id="btn-monitor-toggle" onclick="game.toggleMon()">ABRIR/FECHAR MONITOR</div>

    <div id="monitor">
        <h2 id="cam-title" style="margin: 20px;">CAM 1A</h2>
        
        <div id="dot-Bonnie" class="animatronic-dot" style="background: purple;"></div>
        <div id="dot-Chica" class="animatronic-dot" style="background: yellow;"></div>
        <div id="dot-Freddy" class="animatronic-dot" style="background: brown;"></div>

        <div id="map-ui">
            <div class="cam-btn active" style="grid-area:c1A" onclick="game.setCam('1A')">1A</div>
            <div class="cam-btn" style="grid-area:c1B" onclick="game.setCam('1B')">1B</div>
            <div class="cam-btn" style="grid-area:c1C" onclick="game.setCam('1C')">1C</div>
            <div class="cam-btn" style="grid-area:c5" onclick="game.setCam('5')">5</div>
            <div class="cam-btn" style="grid-area:c7" onclick="game.setCam('7')">7</div>
            <div class="cam-btn" style="grid-area:c6" onclick="game.setCam('6')">6</div>
            <div class="cam-btn" style="grid-area:c3" onclick="game.setCam('3')">3</div>
            <div class="cam-btn" style="grid-area:c2A" onclick="game.setCam('2A')">2A</div>
            <div class="cam-btn" style="grid-area:c2B" onclick="game.setCam('2B')">2B</div>
            <div class="cam-btn" style="grid-area:c4A" onclick="game.setCam('4A')">4A</div>
            <div class="cam-btn" style="grid-area:c4B" onclick="game.setCam('4B')">4B</div>
        </div>
    </div>

    <div id="jumpscare-screen">
        <img id="jumpscare-img" src="https://placehold.co/800x600/red/black?text=SCREAM!!&font=roboto" alt="Jumpscare">
    </div>

</div>

<script>
class Game {
    constructor() {
        this.power = 100;
        this.usage = 1;
        this.monitorOpen = false;
        this.currentCam = '1A';
        this.doors = { left: false, right: false };
        this.lights = { left: false, right: false };
        
        this.animatronics = {
            'Bonnie': { pos: '1A', path: ['1A', '1B', '5', '2A', '2B'] }, // Esquerda
            'Chica': { pos: '1A', path: ['1A', '1B', '7', '4A', '4B'] }, // Direita
            'Freddy': { pos: '1A', path: ['1A', '1B', '7', '4A', '4B'] }
        };

        this.startLoop();
        this.startAI();
    }

    startLoop() {
        setInterval(() => {
            // Calcula gasto de energia
            let drain = 0.1; 
            if(this.doors.left) drain += 0.2;
            if(this.doors.right) drain += 0.2;
            if(this.lights.left) drain += 0.1;
            if(this.lights.right) drain += 0.1;
            if(this.monitorOpen) drain += 0.1;

            this.power -= drain;
            document.getElementById('pwr-val').innerText = Math.floor(this.power);

            if(this.power <= 0) {
                this.jumpscare("Acabou a luz!");
            }
        }, 1000);
    }

    toggleDoor(side) {
        if(this.power <= 0) return;
        this.doors[side] = !this.doors[side];
        // Adiciona classe CSS
        const el = document.getElementById(side === 'left' ? 'door-L' : 'door-R');
        if(this.doors[side]) el.classList.add('door-closed');
        else el.classList.remove('door-closed');
    }

    toggleLight(side) {
        if(this.power <= 0) return;
        this.lights[side] = !this.lights[side];
        
        // Desliga a outra luz se tentar ligar duas
        const other = side === 'left' ? 'right' : 'left';
        this.lights[other] = false;
        document.getElementById(other === 'left' ? 'light-L' : 'light-R').style.opacity = 0;

        // Visual
        const el = document.getElementById(side === 'left' ? 'light-L' : 'light-R');
        el.style.opacity = this.lights[side] ? 1 : 0;
        
        this.checkDoor(side);
    }

    toggleMon() {
        if(this.power <= 0) return;
        this.monitorOpen = !this.monitorOpen;
        document.getElementById('monitor').style.display = this.monitorOpen ? 'block' : 'none';
        if(this.monitorOpen) this.updateCamVisuals();
    }

    setCam(cam) {
        this.currentCam = cam;
        document.getElementById('cam-title').innerText = "CAM " + cam;
        
        // Atualiza botões
        document.querySelectorAll('.cam-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        this.updateCamVisuals();
    }

    checkDoor(side) {
        // Se ligar a luz e o bicho estiver na porta
        if(this.lights[side]) {
            if(side === 'left' && this.animatronics.Bonnie.pos === '2B') {
                document.getElementById('log-ui').innerText = "BONNIE ESTÁ NA PORTA!";
            }
            if(side === 'right' && this.animatronics.Chica.pos === '4B') {
                document.getElementById('log-ui').innerText = "CHICA ESTÁ NA PORTA!";
            }
        }
    }

    updateCamVisuals() {
        // Esconde todos os pontos primeiro
        document.querySelectorAll('.animatronic-dot').forEach(d => d.style.display = 'none');

        // Mostra quem está na câmera atual
        for(let name in this.animatronics) {
            if(this.animatronics[name].pos === this.currentCam) {
                const dot = document.getElementById('dot-'+name);
                dot.style.display = 'block';
                // Posição aleatória na tela para parecer que moveu
                dot.style.top = (20 + Math.random() * 50) + '%';
                dot.style.left = (20 + Math.random() * 50) + '%';
            }
        }
    }

    startAI() {
        setInterval(() => {
            if(this.power <= 0) return;

            // Chance de mover a cada 4 segundos
            for(let name in this.animatronics) {
                if(Math.random() > 0.4) { // 60% de chance de mover
                    this.moveCharacter(name);
                }
            }
            if(this.monitorOpen) this.updateCamVisuals();
        }, 4000);
    }

    moveCharacter(name) {
        const char = this.animatronics[name];
        const currentIdx = char.path.indexOf(char.pos);

        // Se ainda não chegou na porta
        if(currentIdx < char.path.length - 1) {
            char.pos = char.path[currentIdx + 1];
            console.log(`${name} moveu para ${char.pos}`);
        } 
        else {
            // Está na porta! (2B ou 4B)
            const doorSide = name === 'Bonnie' ? 'left' : 'right';
            
            // Se a porta estiver ABERTA, game over
            if(!this.doors[doorSide]) {
                this.jumpscare(name);
            } else {
                // Se fechada, ele volta para o início
                console.log(name + " bateu na porta e voltou.");
                char.pos = '1A';
            }
        }
    }

    jumpscare(who) {
        console.log("MORREU POR: " + who);
        const screen = document.getElementById('jumpscare-screen');
        const img = document.getElementById('jumpscare-img');
        
        screen.style.display = 'flex';
        // Tenta usar um GIF assustador se disponível, senão usa o texto
        img.src = "https://media1.tenor.com/m/x3x7yCgX2iAAAAAC/fnaf-golden-freddy.gif"; 
        
        setTimeout(() => location.reload(), 2500);
    }
}

const game = new Game();
</script>

</body>
    </html>
