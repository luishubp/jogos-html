<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>FNAF Remastered - Fix V3</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #88ff88; }
        body { margin: 0; background: #000; color: #fff; font-family: 'VT323', monospace; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        
        #game-container { position: relative; width: 1280px; height: 720px; border: 2px solid #333; background: #050505; }

        /* --- ESCRITÓRIO --- */
        #office { width: 100%; height: 100%; position: relative; background: #1a1a1a; }
        
        /* Luzes nas Janelas */
        .window-light { 
            position: absolute; top: 20%; width: 15%; height: 60%; 
            opacity: 0; transition: opacity 0.1s; z-index: 5;
            display: flex; justify-content: center; align-items: center;
        }
        #light-L { left: 0; background: linear-gradient(to right, rgba(255,255,200,0.3), transparent); }
        #light-R { right: 0; background: linear-gradient(to left, rgba(255,255,200,0.3), transparent); }

        /* Animatronics na Janela (Só aparecem com luz) */
        .animatronic-at-door { width: 60px; height: 60px; border-radius: 50%; filter: blur(10px); display: none; }

        /* Portas */
        .physical-door { position: absolute; top: -100%; width: 12%; height: 100%; background: #333; border: 2px solid #111; transition: top 0.3s ease-in; z-index: 40; }
        .door-left { left: 15%; } .door-right { right: 15%; }
        .door-closed { top: 0% !important; }

        /* Painéis */
        .control-panel { position: absolute; top: 35%; width: 50px; height: 120px; background: #222; display: flex; flex-direction: column; align-items: center; justify-content: space-around; z-index: 100; border: 1px solid #444; }
        .panel-left { left: 10%; } .panel-right { right: 10%; }
        .btn { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 2px solid #000; font-size: 10px; display: flex; align-items: center; justify-content: center; user-select: none; }
        .btn-door.active { background: #f00; }
        .btn-light.active { background: #ff0; color: #000; }

        /* Monitor */
        #camera-tablet { position: absolute; inset: 0; background: #000; display: none; z-index: 500; padding: 20px; }
        .cam-screen { width: 80%; height: 400px; background: #111; margin: 0 auto; border: 5px solid #333; position: relative; display: flex; justify-content: center; align-items: center; }
        #enemy-sprite { width: 50px; height: 50px; border-radius: 50%; filter: blur(15px); }
        
        #map-area { margin-top: 20px; display: flex; justify-content: center; gap: 10px; }
        .cam-btn { padding: 10px 20px; background: #020; color: #fff; border: 1px solid var(--primary-color); cursor: pointer; font-family: 'VT323'; }
        .cam-btn.active { background: var(--primary-color); color: #000; }

        /* UI e Jumpscare */
        #monitor-trigger { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 300px; height: 40px; background: rgba(255,255,255,0.2); z-index: 1000; cursor: pointer; text-align: center; line-height: 40px; border: 1px solid #fff; }
        .hud { position: absolute; color: var(--primary-color); font-size: 24px; z-index: 1000; }
        #jumpscare { position: absolute; inset: 0; background: #000; z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center; color: red; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="office">
        <div id="light-L" class="window-light"><div id="visual-bonnie" class="animatronic-at-door" style="background: purple;"></div></div>
        <div id="light-R" class="window-light"><div id="visual-chica" class="animatronic-at-door" style="background: yellow;"></div></div>

        <div id="visual-door-L" class="physical-door door-left"></div>
        <div id="visual-door-R" class="physical-door door-right"></div>
        
        <div class="control-panel panel-left">
            <div id="btn-L-door" class="btn btn-door" onclick="game.toggleDoor('left')">DOOR</div>
            <div id="btn-L-light" class="btn btn-light" onmousedown="game.setLight('left',true)" onmouseup="game.setLight('left',false)">LIGHT</div>
        </div>
        <div class="control-panel panel-right">
            <div id="btn-R-door" class="btn btn-door" onclick="game.toggleDoor('right')">DOOR</div>
            <div id="btn-R-light" class="btn btn-light" onmousedown="game.setLight('right',true)" onmouseup="game.setLight('right',false)">LIGHT</div>
        </div>
    </div>

    <div id="camera-tablet">
        <div class="cam-screen">
            <div id="cam-label" style="position:absolute; top:10px; left:10px; color:var(--primary-color);">CAM 1A</div>
            <div id="enemy-sprite"></div>
        </div>
        <div id="map-area">
            <button id="b1A" class="cam-btn" onclick="game.switchCam('1A')">1A</button>
            <button id="b1B" class="cam-btn" onclick="game.switchCam('1B')">1B</button>
            <button id="b2A" class="cam-btn" onclick="game.switchCam('2A')">2A</button>
            <button id="b4B" class="cam-btn" onclick="game.switchCam('4B')">4B</button>
        </div>
    </div>

    <div class="hud" style="bottom: 20px; left: 20px;">POWER: <span id="pwr">100</span>%</div>
    <div class="hud" style="top: 20px; right: 20px;" id="clk">12 AM</div>
    <div id="monitor-trigger" onclick="game.toggleMonitor()">ABRIR MONITOR</div>
    
    <div id="jumpscare">
        <h1 id="scare-name">BOO!</h1>
        <p>GAME OVER</p>
    </div>
</div>

<script>
class FNAFGame {
    constructor() {
        this.power = 100;
        this.hour = 0;
        this.monitorOpen = false;
        this.currentCam = '1A';
        this.doors = { left: false, right: false };
        this.lights = { left: false, right: false };
        
        this.enemies = {
            'Bonnie': { pos: '1B', color: 'purple', side: 'left', path: ['1B', '4B', 'DoorL'] },
            'Chica': { pos: '1A', color: 'yellow', side: 'right', path: ['1A', '2A', 'DoorR'] }
        };

        this.init();
    }

    init() {
        setInterval(() => this.tick(), 1000);
        setInterval(() => this.moveAI(), 5000); // Tenta mover a cada 5 segundos
        setInterval(() => this.updateClock(), 60000);
    }

    tick() {
        let usage = 0.1;
        if(this.doors.left) usage += 0.3;
        if(this.doors.right) usage += 0.3;
        if(this.monitorOpen) usage += 0.2;
        if(this.lights.left || this.lights.right) usage += 0.2;

        this.power -= usage;
        document.getElementById('pwr').innerText = Math.max(0, Math.floor(this.power));
        if(this.power <= 0) location.reload();
    }

    updateClock() {
        this.hour++;
        document.getElementById('clk').innerText = (this.hour === 0 ? 12 : this.hour) + " AM";
        if(this.hour >= 6) { alert("Você sobreviveu!"); location.reload(); }
    }

    toggleDoor(side) {
        this.doors[side] = !this.doors[side];
        document.getElementById(`visual-door-${side==='left'?'L':'R'}`).classList.toggle('door-closed', this.doors[side]);
        document.getElementById(`btn-${side==='left'?'L':'R'}-door`).classList.toggle('active', this.doors[side]);
    }

    setLight(side, state) {
        this.lights[side] = state;
        const lightEl = document.getElementById(`light-${side==='left'?'L':'R'}`);
        lightEl.style.opacity = state ? 1 : 0;
        document.getElementById(`btn-${side==='left'?'L':'R'}-light`).classList.toggle('active', state);
        
        // Se a luz acender, verifica se o bicho está na porta
        this.updateDoorVisuals();
    }

    updateDoorVisuals() {
        // Bonnie na porta esquerda
        document.getElementById('visual-bonnie').style.display = 
            (this.enemies['Bonnie'].pos === 'DoorL' && this.lights.left) ? 'block' : 'none';
        
        // Chica na porta direita
        document.getElementById('visual-chica').style.display = 
            (this.enemies['Chica'].pos === 'DoorR' && this.lights.right) ? 'block' : 'none';
    }

    toggleMonitor() {
        this.monitorOpen = !this.monitorOpen;
        document.getElementById('camera-tablet').style.display = this.monitorOpen ? 'block' : 'none';
        if(this.monitorOpen) this.switchCam(this.currentCam);
    }

    switchCam(id) {
        this.currentCam = id;
        document.getElementById('cam-label').innerText = "CAM " + id;
        document.querySelectorAll('.cam-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('b'+id).classList.add('active');
        this.updateCamVisual();
    }

    updateCamVisual() {
        const sprite = document.getElementById('enemy-sprite');
        sprite.style.background = 'transparent';
        
        for(let name in this.enemies) {
            if(this.enemies[name].pos === this.currentCam) {
                sprite.style.background = this.enemies[name].color;
                return;
            }
        }
    }

    moveAI() {
        for(let name in this.enemies) {
            let e = this.enemies[name];
            if(Math.random() > 0.5) { // 50% de chance de mover
                let currentIdx = e.path.indexOf(e.pos);
                
                if(currentIdx < e.path.length - 1) {
                    // Move para o próximo ponto no caminho fixo
                    e.pos = e.path[currentIdx + 1];
                } else if(e.pos.startsWith('Door')) {
                    // Se já está na porta, tenta atacar
                    if(!this.doors[e.side]) {
                        this.triggerJumpscare(name);
                    } else {
                        e.pos = e.path[0]; // Volta para o início se a porta estiver fechada
                    }
                }
            }
        }
        if(this.monitorOpen) this.updateCamVisual();
        this.updateDoorVisuals();
    }

    triggerJumpscare(name) {
        const js = document.getElementById('jumpscare');
        js.style.display = 'flex';
        js.style.background = (name === 'Bonnie') ? '#100' : '#110';
        document.getElementById('scare-name').innerText = name.toUpperCase() + " TE PEGOU!";
        setTimeout(() => location.reload(), 3000);
    }
}
const game = new FNAFGame();
</script>
</body>
</html>

