<!DOCTYPE html>
<html>
<head>
    <title>Alien Space Wars - Prototipo Grok</title>
    <style>body { margin: 0; background: #000; } canvas { display: block; }</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 600;

let player = { x: 50, y: 300, w: 40, h: 30, speed: 5, hp: 100 };
let bullets = [];
let aliens = [];
let particles = [];
let score = 0;
let keys = {};

document.addEventListener('keydown', e => keys[e.code] = true);
document.addEventListener('keyup', e => keys[e.code] = false);

function shoot() {
    bullets.push({ x: player.x + player.w, y: player.y + player.h/2 - 2, w: 10, h: 4, speed: 8 });
}
setInterval(shoot, 200); // Auto-fire pra testar

function update() {
    // Player
    if (keys['ArrowUp'] && player.y > 0) player.y -= player.speed;
    if (keys['ArrowDown'] && player.y < canvas.height - player.h) player.y += player.speed;
    if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
    if (keys['ArrowRight'] && player.x < canvas.width - player.w) player.x += player.speed;
    if (keys['Space']) shoot();

    // Bullets
    bullets = bullets.filter(b => {
        b.x += b.speed;
        return b.x < canvas.width;
    });

    // Aliens spawn
    if (Math.random() < 0.02) {
        aliens.push({ x: canvas.width, y: Math.random() * (canvas.height - 40), w: 40, h: 30, speed: 2 + Math.random() * 2 });
    }
    aliens.forEach(a => {
        a.x -= a.speed;
        // Colisão player-alien
        if (a.x < player.x + player.w && a.x + a.w > player.x && a.y < player.y + player.h && a.y + a.h > player.y) {
            player.hp -= 10;
            a.x = -100; // Remove
        }
    });
    aliens = aliens.filter(a => a.x > -50);

    // Colisão bullets-aliens
    bullets.forEach((b, bi) => {
        aliens.forEach((a, ai) => {
            if (b.x < a.x + a.w && b.x + b.w > a.x && b.y < a.y + a.h && b.y + b.h > a.y) {
                score += 10;
                createParticles(a.x + a.w/2, a.y + a.h/2);
                bullets.splice(bi, 1);
                aliens.splice(ai, 1);
            }
        });
    });

    // Particles explosão
    particles = particles.filter(p => {
        p.x += p.vx;
        p.y += p.vy;
        p.life--;
        return p.life > 0;
    });
}

function createParticles(x, y) {
    for (let i = 0; i < 10; i++) {
        particles.push({
            x, y,
            vx: (Math.random() - 0.5) * 10,
            vy: (Math.random() - 0.5) * 10,
            life: 20
        });
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Estrelas bg
    ctx.fillStyle = '#fff';
    for (let i = 0; i < 100; i++) {
        ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, 1, 1);
    }

    // Player (nave cyborg)
    ctx.fillStyle = '#0f0';
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = '#fff';
    ctx.fillRect(player.x + 5, player.y + 5, 10, 5); // Cockpit

    // Bullets
    ctx.fillStyle = '#ff0';
    bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

    // Aliens (verdes xenomorfos)
    ctx.fillStyle = '#f00';
    aliens.forEach(a => {
        ctx.fillRect(a.x, a.y, a.w, a.h);
        ctx.fillStyle = '#fff';
        ctx.fillRect(a.x + 10, a.y + 5, 5, 5); // Olho
        ctx.fillStyle = '#f00';
    });

    // Particles
    particles.forEach(p => {
        ctx.fillStyle = `rgba(255, ${Math.floor(255 * p.life / 20)}, 0, ${p.life / 20})`;
        ctx.fillRect(p.x, p.y, 3, 3);
    });

    // UI
    ctx.fillStyle = '#fff';
    ctx.font = '20px Arial';
    ctx.fillText(`Score: ${score}`, 10, 30);
    ctx.fillText(`HP: ${player.hp}`, 10, 60);
    if (player.hp <= 0) {
        ctx.fillStyle = '#f00';
        ctx.fillText('GAME OVER! Reload pra jogar de novo', 200, 300);
    }
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>        this.hour = 0;
        this.isGameOver = false;
        this.monitorOpen = false;
        this.currentCam = '1A';
        
        this.doors = { left: false, right: false };
        this.lights = { left: false, right: false };
        
        // IA e Posicionamento (0: Palco, 1: Corredor, 2: Porta, 3: Office)
        this.enemies = {
            'Freddy': { pos: '1A', difficulty: 1 },
            'Bonnie': { pos: '1A', difficulty: 3 },
            'Chica': { pos: '1A', difficulty: 2 },
            'Foxy': { pos: '3', difficulty: 1, stage: 0 } // Foxy usa estágio em vez de pos
        };

        this.init();
    }

    init() {
        // Ciclo de Energia (cada 1s reduz baseado no uso)
        setInterval(() => this.updatePower(), 1000);
        // Ciclo de Tempo (cada 60s muda a hora)
        setInterval(() => this.updateClock(), 45000);
        // Ciclo de IA (cada 5s tenta mover)
        setInterval(() => this.updateAI(), 5000);
        
        this.render();
    }

    updatePower() {
        if (this.isGameOver) return;

        let usage = 0.1; // Consumo passivo
        if (this.doors.left) usage += 0.4;
        if (this.doors.right) usage += 0.4;
        if (this.lights.left || this.lights.right) usage += 0.2;
        if (this.monitorOpen) usage += 0.3;

        this.power -= usage;
        if (this.power <= 0) {
            this.power = 0;
            this.blackout();
        }
        document.getElementById('power-usage').innerText = Math.floor(this.power);
    }

    updateClock() {
        if (this.isGameOver) return;
        this.hour++;
        if (this.hour >= 6) this.winNight();
        document.getElementById('clock').innerText = this.hour + " AM";
    }

    toggleDoor(side) {
        if (this.power <= 0) return;
        this.doors[side] = !this.doors[side];
        document.getElementById(`btn-${side}-door`).style.background = this.doors[side] ? "#090" : "#900";
    }

    setLight(side, state) {
        if (this.power <= 0) return;
        this.lights[side] = state;
        const office = document.getElementById('office-view');
        if (state) {
            office.style.background = "#fff";
            office.innerText = this.checkDoorForEnemy(side) ? "HÁ ALGO NA PORTA!" : "CORREDOR VAZIO";
        } else {
            office.style.background = "transparent";
            office.innerText = "SALA DE SEGURANÇA";
        }
    }

    toggleMonitor() {
        if (this.power <= 0) return;
        this.monitorOpen = !this.monitorOpen;
        document.getElementById('camera-tablet').style.display = this.monitorOpen ? 'block' : 'none';
    }

    switchCam(camId) {
        this.currentCam = camId;
        document.getElementById('cam-name').innerText = "CAM " + camId;
        document.querySelectorAll('.cam-btn').forEach(b => b.classList.remove('active-cam'));
        // Atualiza visual da câmera baseado na posição dos inimigos
        this.updateCamDisplay();
    }

    updateAI() {
        if (this.isGameOver || this.power <= 0) return;

        // Lógica Simplificada do Bonnie (Lado Esquerdo)
        if (Math.random() * 20 < this.enemies.Bonnie.difficulty + this.night) {
            this.moveEnemy('Bonnie', ['1A', '1B', '2A', 'DoorL', 'Office']);
        }
    }

    moveEnemy(name, path) {
        let currentIdx = path.indexOf(this.enemies[name].pos);
        if (currentIdx < path.length - 1) {
            let nextPos = path[currentIdx + 1];
            
            // Se tentar entrar na sala
            if (nextPos === 'Office') {
                if (this.doors.left) {
                    this.enemies[name].pos = '1B'; // Volta pro corredor
                } else {
                    this.triggerJumpscare();
                }
            } else {
                this.enemies[name].pos = nextPos;
            }
        }
    }

    checkDoorForEnemy(side) {
        if (side === 'left') return this.enemies.Bonnie.pos === 'DoorL';
        return false;
    }

    updateCamDisplay() {
        let content = "ÁREA VAZIA";
        for (let name in this.enemies) {
            if (this.enemies[name].pos === this.currentCam) {
                content = "MOVIMENTO DETECTADO: " + name;
            }
        }
        document.getElementById('cam-content').innerText = content;
    }

    blackout() {
        this.isGameOver = true;
        document.getElementById('office').style.display = 'none';
        document.getElementById('camera-tablet').style.display = 'none';
        setTimeout(() => this.triggerJumpscare(), 5000);
    }

    triggerJumpscare() {
        if (this.isGameOver && this.power > 0) return;
        this.isGameOver = true;
        document.getElementById('jumpscare').style.display = 'flex';
        setTimeout(() => location.reload(), 3000);
    }

    winNight() {
        alert("6 AM - VOCÊ SOBREVIVEU À NOITE " + this.night);
        this.night++;
        this.power = 100;
        this.hour = 0;
        location.reload();
    }

    render() {
        // Mouse look effect
        window.addEventListener('mousemove', (e) => {
            if (!this.monitorOpen) {
                let move = (e.clientX / window.innerWidth - 0.5) * 40;
                document.getElementById('office').style.transform = `translateX(${-move}px)`;
            }
        });
    }
}

const game = new FNAFGame();
</script>

</body>
</html>

